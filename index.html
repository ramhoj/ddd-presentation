<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Design at the Center</title>

  <!-- Teamtailor fonts: Inter -->
  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

  <!-- Prism.js for syntax highlighting -->
  <link rel="stylesheet" href="prism-theme.css">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="presentation">

    <!-- ============================================================
         CHAPTER 1: INTRODUCTION
         ============================================================ -->

    <!-- ================================================================
         Title
         ================================================================ -->
    <section class="slide slide--gradient" id="title">
      <div class="slide-inner">
        <h1 class="slide-title slide-title--large">The Domain<br>at the Center</h1>
        <p class="slide-subtitle">Lessons from 37signals on writing maintainable code that is easy to reason about and beautiful to read.</p>
      </div>

      <nav class="slide-nav">
        <span class="nav-disabled">‚Üê</span>
        <a href="#about-me" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         About Me
         ================================================================ -->
    <section class="slide slide--dark" id="about-me">
      <div class="slide-inner">
        <div class="about-layout">
          <div class="about-text">
            <h2 class="slide-title">Nicklas Ramh√∂j Holtryd</h2>
            <p class="about-bio">
              I'm a developer at <strong>Teamtailor</strong>, based in Gothenburg, Sweden.
              Prior to joining Teamtailor, I spent three years at <strong>37signals</strong> working
              on <strong>Basecamp</strong> and <strong>HEY</strong>‚Äîwhere I picked up some ideas about code design that
              I'd like to share with you today.
            </p>
          </div>
          <img src="profile-photo-cropped-3.jpeg" alt="Nicklas Ramh√∂j Holtryd" class="profile-photo">
        </div>
      </div>

      <nav class="slide-nav">
        <a href="#title" class="nav-link">‚Üê</a>
        <a href="#what-is-ddd" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         What is DDD?
         ================================================================ -->
    <section class="slide slide--dark" id="what-is-ddd">
      <div class="slide-inner">
        <h2 class="slide-title">Domain-Driven Design</h2>
        <p class="slide-subtitle" style="margin-bottom: 2.5rem;">A philosophy for structuring complex software, coined by Eric Evans in 2003</p>

        <div class="ddd-principles">
          <div class="ddd-principle">
            <span class="ddd-principle-icon">üí¨</span>
            <h3>Ubiquitous Language</h3>
            <p>Code uses the same terms as the business. If users "gild" a card, the code says <code>card.gild</code>.</p>
          </div>

          <div class="ddd-principle">
            <span class="ddd-principle-icon">üß†</span>
            <h3>Rich Domain Models</h3>
            <p>Models contain behavior, not just data. They represent real business concepts.</p>
          </div>

          <div class="ddd-principle">
            <span class="ddd-principle-icon">üéØ</span>
            <h3>Domain at the Center</h3>
            <p>Everything else‚Äîcontrollers, jobs, APIs‚Äîorchestrates the domain. The domain is the core.</p>
          </div>
        </div>
      </div>

      <nav class="slide-nav">
        <a href="#about-me" class="nav-link">‚Üê</a>
        <a href="#chapter-rich-models" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         CHAPTER 2: RICH DOMAIN MODELS
         ============================================================ -->

    <!-- ================================================================
         Chapter Divider: Rich Domain Models
         ================================================================ -->
    <section class="slide slide--accent" id="chapter-rich-models">
      <div class="slide-inner">
        <p class="chapter-label">Chapter 1</p>
        <h2 class="slide-title slide-title--large">Rich Domain Models</h2>
        <p class="slide-subtitle">Organizing behavior with concerns</p>
      </div>

      <nav class="slide-nav">
        <a href="#what-is-ddd" class="nav-link">‚Üê</a>
        <a href="#domain-center" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Domain at the Center (Epicenter Philosophy)
         ================================================================ -->
    <section class="slide slide--dark" id="domain-center">
      <div class="slide-inner">
        <h2 class="slide-title">The Epicenter Philosophy</h2>

        <p class="slide-text" style="margin-bottom: 2rem;">
          In ShapeUp we start with the epicenter and work our way out.<br>
          We can apply the same philosophy to code organization.
        </p>

        <p class="slide-text">
          The domain model defines our epicenter ‚Äî the <em>behaviors and nouns</em> of our business.<br>
          Roles and traits extend outward as concern modules, utilizing object composition when necessary.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#chapter-rich-models" class="nav-link">‚Üê</a>
        <a href="#code-card-model" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Code: Card Model
         ================================================================ -->
    <section class="slide slide--dark" id="code-card-model">
      <div class="slide-inner">
        <h2 class="slide-title">Rich, coherent domain objects</h2>

        <div class="code-container">
          <span class="code-filename">app/models/card.rb</span>
          <pre class="code-block"><code class="language-ruby">class Card < ApplicationRecord
  include Broadcastable, Eventable, Golden, Searchable, Stallable

  belongs_to :board
  belongs_to :creator, class_name: "User", default: -> { Current.user }

  has_rich_text :description

  scope :chronologically, -> { order created_at: :asc, id: :asc  }

  def to_param
    number.to_s
  end

  def move_to(new_board)
    transaction do
      card.update! board: new_board
      card.events.update_all board_id: new_board.id
    end
  end
end</code></pre>
        </div>

        <p class="slide-text">
          Concerns organize traits and roles. The model stays readable and coherent.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#domain-center" class="nav-link">‚Üê</a>
        <a href="#code-concern" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Code: Concern Example
         ================================================================ -->
    <section class="slide slide--dark" id="code-concern">
      <div class="slide-inner">
        <h2 class="slide-title">Traits as concerns</h2>

        <div class="code-container">
          <span class="code-filename">app/models/card/golden.rb</span>
          <pre class="code-block"><code class="language-ruby">module Card::Golden
  extend ActiveSupport::Concern

  included do
    has_one :goldness, dependent: :destroy
    scope :golden, -> { joins(:goldness) }
  end

  def golden?
    goldness.present?
  end

  def gild
    create_goldness! unless golden?
  end

  def ungild
    goldness&.destroy
  end
end</code></pre>
        </div>

        <p class="slide-text">
          Things that belong together, live together. Easy to understand, easy to maintain, minimal distractions.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#code-card-model" class="nav-link">‚Üê</a>
        <a href="#chapter-simpler-way" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         CHAPTER 3: A SIMPLER WAY
         ============================================================ -->

    <!-- ================================================================
         Chapter Divider: A Simpler Way
         ================================================================ -->
    <section class="slide slide--accent" id="chapter-simpler-way">
      <div class="slide-inner">
        <p class="chapter-label">Chapter 2</p>
        <h2 class="slide-title slide-title--large">Focus on intent, not implementation</h2>
        <p class="slide-subtitle">Code that reads like prose, not like a computer science textbook</p>
      </div>

      <nav class="slide-nav">
        <a href="#code-concern" class="nav-link">‚Üê</a>
        <a href="#service-comparison" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Service Object Comparison
         ================================================================ -->
    <section class="slide slide--dark" id="service-comparison">
      <div class="slide-inner">
        <h2 class="slide-title">Boilerplate obscures intent</h2>

        <div class="code-tabs">
          <div class="code-tabs-nav">
            <button class="code-tab active" data-tab="simple">Simple: single domain call</button>
            <button class="code-tab" data-tab="complex">Complex: multi-entity orchestration</button>
          </div>

          <div class="code-tab-content active" id="tab-simple">
            <div class="comparison">
              <div class="comparison-side comparison-side--bad">
                <h3>With a service object</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby"># In the controller
Card::SendBackToTriage.call(card)

# Separate class required
class Card::SendBackToTriage
  def initialize(card)
    @card = card
  end

  def call
    @card.send_back_to_triage
  end
end</code></pre>
                </div>
              </div>

              <div class="comparison-side comparison-side--good">
                <h3>Directly on the domain</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby"># In the controller
card.send_back_to_triage


# That's it.
# The behavior lives
# in the domain model.</code></pre>
                </div>
              </div>
            </div>
          </div>

          <div class="code-tab-content" id="tab-complex">
            <div class="comparison">
              <div class="comparison-side comparison-side--bad">
                <h3>With a service object</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby">class Board::UpdateService
  def initialize(board, params, users)
    @board = board
    @params = params
    @users = users
  end

  def call
    @board.update!(@params)
    @board.accesses.revise(@users)
  end
end</code></pre>
                </div>
              </div>

              <div class="comparison-side comparison-side--good">
                <h3>With a form object</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby">class Board::Form
  include ActiveModel::Model
  attr_accessor :board, :name, :users

  def save
    board.update!(name:)
    board.accesses.revise(users)
  end
end</code></pre>
                </div>
              </div>
            </div>
            <p class="slide-text" style="margin-top: 1rem; font-size: 1rem;">
              When coordinating multiple entities, a form object keeps it in the domain‚Äîwith validation, semantic naming, and no <code>call</code>.
            </p>
          </div>
        </div>

        <p class="slide-text">
          What isn't there is as important as what is.<br>
          The sooner we can get to the point, the faster we'll understand the intent.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#chapter-simpler-way" class="nav-link">‚Üê</a>
        <a href="#semantic-naming" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Semantic Naming
         ================================================================ -->
    <section class="slide slide--dark" id="semantic-naming">
      <div class="slide-inner">
        <h2 class="slide-title">Semantic names over generic patterns</h2>

        <div class="naming-examples">
          <div class="naming-row">
            <code class="naming-bad">CardGildingService.call(card)</code>
            <span class="naming-arrow">‚Üí</span>
            <code class="naming-good">card.gild</code>
          </div>
          <div class="naming-row">
            <code class="naming-bad">ResumeCardOperation.new(card).execute</code>
            <span class="naming-arrow">‚Üí</span>
            <code class="naming-good">card.resume</code>
          </div>
        </div>

        <p class="slide-text" style="margin-top: 2rem;">
          Generic verbs like <code>call</code> and <code>execute</code> say nothing about intent, they don't add value or information.<br>
          Domain methods read like prose: <em>"Is the card gilded?"</em>, <em>"Gild the card."</em>
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#service-comparison" class="nav-link">‚Üê</a>
        <a href="#chapter-orchestration" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         CHAPTER 4: ORCHESTRATION & COMPOSITION
         ============================================================ -->

    <!-- ================================================================
         Chapter Divider: Orchestration
         ================================================================ -->
    <section class="slide slide--accent" id="chapter-orchestration">
      <div class="slide-inner">
        <p class="chapter-label">Chapter 3</p>
        <h2 class="slide-title slide-title--large">Orchestration</h2>
        <p class="slide-subtitle">Controllers and jobs</p>
      </div>

      <nav class="slide-nav">
        <a href="#semantic-naming" class="nav-link">‚Üê</a>
        <a href="#quote-service-objects" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Quote: Service Objects
         ================================================================ -->
    <section class="slide slide--pattern" id="quote-service-objects">
      <div class="slide-inner">
        <div class="quote">
          <p class="quote-text">Service objects are not meant to implement your business logic. They are meant to orchestrate your domain objects.</p>
          <p class="quote-author">Jorge Manrubia, 37signals</p>
        </div>
      </div>

      <nav class="slide-nav">
        <a href="#chapter-orchestration" class="nav-link">‚Üê</a>
        <a href="#code-controller" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Code: Controller
         ================================================================ -->
    <section class="slide slide--dark" id="code-controller">
      <div class="slide-inner">
        <h2 class="slide-title">Thin orchestration layers</h2>

        <div class="code-tabs">
          <div class="code-tabs-nav">
            <button class="code-tab active" data-tab="controller">app/controllers/cards/closures_controller.rb</button>
            <button class="code-tab" data-tab="job">app/jobs/detect_activity_spikes_job.rb</button>
          </div>

          <div class="code-tab-content active" id="tab-controller">
            <pre class="code-block"><code class="language-ruby">class Cards::ClosuresController < ApplicationController
  include CardScoped

  def create
    @card.close
  end

  def destroy
    @card.reopen
  end
end</code></pre>
          </div>

          <div class="code-tab-content" id="tab-job">
            <pre class="code-block"><code class="language-ruby">class DetectActivitySpikesJob < ApplicationJob
  def perform(card)
    card.detect_activity_spikes
  end
end</code></pre>
          </div>
          <p class="slide-text" style="margin-top: 1rem; color: var(--tt-grey-43);">
            Controllers connect our domain models with the external world.
            In much the same way, jobs act as a thin layer of orchestration for our domain logic.
          </p>
          <p class="slide-text" style="margin-top: 1rem; color: var(--tt-grey-43);">
            These <em>are</em> our service objects, we just don't call them that.
          </p>
        </div>

      </div>

      <nav class="slide-nav">
        <a href="#quote-service-objects" class="nav-link">‚Üê</a>
        <a href="#concerns-composition" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Concerns + Composition
         ================================================================ -->
    <section class="slide slide--dark" id="concerns-composition">
      <div class="slide-inner">
        <h2 class="slide-title">Concerns + object composition = ‚ù§Ô∏è</h2>

        <div class="code-container">
          <span class="code-filename">app/models/card/stallable.rb</span>
          <pre class="code-block"><code class="language-ruby">module Card::Stallable
  extend ActiveSupport::Concern

  included do
    has_one :activity_spike, class_name: "Card::ActivitySpike"
    after_update_commit :detect_activity_spikes
  end

  def stalled?
    open? && last_activity_spike_at < 14.days.ago
  end

  def detect_activity_spikes
    Card::ActivitySpike::Detector.new(self).detect
  end
end</code></pre>
        </div>

        <p class="slide-text">
          The concern organizes the API. The <code>Detector</code> object takes care of detection details.<br>
          Concerns don't replace object-oriented design‚Äîthey complement it.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#code-controller" class="nav-link">‚Üê</a>
        <a href="#takeaways" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         TAKEAWAYS
         ============================================================ -->

    <!-- ================================================================
         Key Takeaways
         ================================================================ -->
    <section class="slide slide--gradient" id="takeaways">
      <div class="slide-inner">
        <h2 class="slide-title">Key Takeaways</h2>

        <ul class="takeaways">
          <li>Let the domain model take the center stage in your architecture</li>
          <li>Use concerns to organize traits that belong together</li>
          <li>Prefer semantic names over generic verbs like <code>call</code></li>
          <li>Controllers and jobs orchestrate; they don't hold business logic</li>
          <li>Minimize boilerplate to allow intent to be more directly accessible</li>
          <li>Prioritize what's coherent for humans over theoretical purity</li>
        </ul>
      </div>

      <nav class="slide-nav">
        <a href="#concerns-composition" class="nav-link">‚Üê</a>
        <span class="nav-disabled">‚Üí</span>
      </nav>
    </section>

  </div>

  <!-- Prism.js for syntax highlighting -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js"></script>

  <!-- Keyboard navigation -->
  <script src="keyboard.js"></script>
</body>
</html>
