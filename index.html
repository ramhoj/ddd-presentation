<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Design at the Center</title>

  <!-- Teamtailor fonts: Inter -->
  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

  <!-- Prism.js for syntax highlighting -->
  <link rel="stylesheet" href="prism-theme.css">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="presentation">

    <!-- ============================================================
         CHAPTER 1: INTRODUCTION
         ============================================================ -->

    <!-- ================================================================
         Title
         ================================================================ -->
    <section class="slide slide--gradient" id="title">
      <div class="slide-inner">
        <h1 class="slide-title slide-title--large">The Domain<br>at the Center</h1>
        <p class="slide-subtitle">Lessons from 37signals on writing maintainable code that is easy to reason about and beautiful to read.</p>
      </div>

      <nav class="slide-nav">
        <span class="nav-disabled">‚Üê</span>
        <a href="#about-me" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         About Me
         ================================================================ -->
    <section class="slide slide--dark" id="about-me">
      <div class="slide-inner">
        <div class="about-layout">
          <div class="about-text">
            <h2 class="slide-title">Nicklas Ramh√∂j Holtryd</h2>
            <p class="about-bio">New on the product team in Gothenburg</p>
            <p class="about-bio">Previously 3 years at <strong>37signals</strong> ‚Äî <strong>Basecamp</strong> & <strong>HEY</strong></p>
            <p class="about-bio">Sharing ideas from Jorge's <a href="https://www.youtube.com/watch?v=dvPXFnX60cg">Fizzy presentation</a></p>
          </div>
          <img src="profile-photo-cropped-3.jpeg" alt="Nicklas Ramh√∂j Holtryd" class="profile-photo">
        </div>

        <p class="speaker-notes">
          I'm the new developer on the product team in Gothenburg.
          Prior to joining Teamtailor three weeks ago, I spent three years at 37signals working on Basecamp and HEY.
          37signals have a lot of strong preferences when it comes to code design and some of you might have seen Jorge Manrubia talk about it in his Fizzy presentation recently.
          I wanted to take the opportunity to share some of these ideas for those who haven't had a chance to watch Jorge's presentation yet, as well as trying to answer any questions you might have from watching it.
          Finally, I'm very eager to learn more about Teamtailor's code design philosophy, how it differs from 37signals', and what we can learn from each other in an effort to make the code we write together at Teamtailor even better.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#title" class="nav-link">‚Üê</a>
        <a href="#what-is-ddd" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         What is DDD?
         ================================================================ -->
    <section class="slide slide--dark" id="what-is-ddd">
      <div class="slide-inner">
        <h2 class="slide-title">Domain-Driven Design</h2>
        <p class="slide-subtitle" style="margin-bottom: 2.5rem;">A philosophy for structuring complex software, coined by Eric Evans in 2003</p>

        <div class="ddd-principles">
          <div class="ddd-principle">
            <span class="ddd-principle-icon">üß†</span>
            <h3>Rich Domain Models</h3>
            <p>Models contain behavior, not just data. They represent real business concepts.</p>
          </div>

          <div class="ddd-principle">
            <span class="ddd-principle-icon">üí¨</span>
            <h3>Ubiquitous Language</h3>
            <p>Code uses the same terms as the business. If users "gild" a card, the code says <code>card.gild</code>.</p>
          </div>

          <div class="ddd-principle">
            <span class="ddd-principle-icon">üéØ</span>
            <h3>Domain at the Center</h3>
            <p>Everything else‚Äîcontrollers, jobs, APIs‚Äîorchestrates the domain. The domain is the core.</p>
          </div>
        </div>

        <p class="speaker-notes">
          So, Jorge mentions DDD in his video. DDD comes down to three core ideas: rich domain models, ubiquitous language, and domain at the center. In the next slides I'll get to some examples of what this meant in practice at 37signals.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#about-me" class="nav-link">‚Üê</a>
        <a href="#chapter-rich-models" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         CHAPTER 2: RICH DOMAIN MODELS
         ============================================================ -->

    <!-- ================================================================
         Chapter Divider: Rich Domain Models
         ================================================================ -->
    <section class="slide slide--accent" id="chapter-rich-models">
      <div class="slide-inner">
        <p class="chapter-label">Chapter 1</p>
        <h2 class="slide-title slide-title--large">Rich Domain Models</h2>
        <p class="slide-subtitle">Organizing behavior with concerns</p>
      </div>

      <nav class="slide-nav">
        <a href="#what-is-ddd" class="nav-link">‚Üê</a>
        <a href="#domain-center" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Domain at the Center (Epicenter Philosophy)
         ================================================================ -->
    <section class="slide slide--dark" id="domain-center">
      <div class="slide-inner">
        <h2 class="slide-title">The Epicenter</h2>

        <div class="epicenter-visual">
          <div class="epicenter-ring epicenter-ring--outer">
            <span class="epicenter-label epicenter-label--top">Controllers</span>
            <span class="epicenter-label epicenter-label--bottom">Jobs</span>
            <div class="epicenter-ring epicenter-ring--middle">
              <span class="epicenter-label epicenter-label--left">Golden</span>
              <span class="epicenter-label epicenter-label--right">Stallable</span>
              <div class="epicenter-ring epicenter-ring--center">
                <span class="epicenter-core">Card</span>
              </div>
            </div>
          </div>
        </div>

        <p class="slide-text" style="margin-top: 2rem;">
          Start with the domain model at the center. Build outward with concerns and orchestration layers.
        </p>

        <p class="speaker-notes">
          Domain driven design and ShapeUp share the same technique of starting with the epicenter and working our way out.
          When organizing our code we place our domain model in the center and build outwards.
          From there roles and traits can be extended outward as concern modules, utilizing object composition when necessary.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#chapter-rich-models" class="nav-link">‚Üê</a>
        <a href="#code-card-model" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Code: Card Model
         ================================================================ -->
    <section class="slide slide--dark" id="code-card-model">
      <div class="slide-inner">
        <h2 class="slide-title">Rich, coherent domain objects</h2>

        <div class="code-container">
          <span class="code-filename">app/models/card.rb</span>
          <pre class="code-block"><code class="language-ruby">class Card < ApplicationRecord
  include Broadcastable, Eventable, Golden, Searchable, Stallable

  belongs_to :board
  belongs_to :creator, class_name: "User", default: -> { Current.user }

  has_rich_text :description

  scope :chronologically, -> { order created_at: :asc, id: :asc  }

  def to_param
    number.to_s
  end

  def move_to(new_board)
    transaction do
      card.update! board: new_board
      card.events.update_all board_id: new_board.id
    end
  end
end</code></pre>
        </div>

        <p class="slide-text">
          Concerns organize traits and roles. The model stays readable and coherent.
        </p>

        <p class="speaker-notes">
          So this is the Card model from Fizzy.
          The Card is a central entity so it has a lot going on but thanks to Concerns we can still grasp it easily enough.
          Each Concern defines a specific trait.
          Golden means it can be gilded, Stallable tracks activity spikes and so on.
          The model itself stays focused on what defines the core: associations, scopes, and a few key methods.
          You can open this file and immediately understand what a Card is and does.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#domain-center" class="nav-link">‚Üê</a>
        <a href="#code-concern" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Code: Concern Example
         ================================================================ -->
    <section class="slide slide--dark" id="code-concern">
      <div class="slide-inner">
        <h2 class="slide-title">Traits as concerns</h2>

        <div class="code-container">
          <span class="code-filename">app/models/card/golden.rb</span>
          <pre class="code-block"><code class="language-ruby">module Card::Golden
  extend ActiveSupport::Concern

  included do
    has_one :goldness, dependent: :destroy
    scope :golden, -> { joins(:goldness) }
  end

  def golden?
    goldness.present?
  end

  def gild
    create_goldness! unless golden?
  end

  def ungild
    goldness&.destroy
  end
end</code></pre>
          <p class="slide-text">
            Things that belong together, live together. Easy to understand, easy to maintain, minimal distractions.
          </p>
        </div>


        <p class="speaker-notes">
          Here's what one of those concerns looks like inside.
          Everything about gilding lives in this one file‚Äîthe association, the scope, the methods.
          If I need to change how gilding works, I go to one place.
          Jorge talks about this a lot: things that belong together should live together.
          It's also nice how readable the methods are‚Äîgolden?, gild, ungild.
          That's the ubiquitous language pillar in action.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#code-card-model" class="nav-link">‚Üê</a>
        <a href="#chapter-simpler-way" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         CHAPTER 3: A SIMPLER WAY
         ============================================================ -->

    <!-- ================================================================
         Chapter Divider: A Simpler Way
         ================================================================ -->
    <section class="slide slide--accent" id="chapter-simpler-way">
      <div class="slide-inner">
        <p class="chapter-label">Chapter 2</p>
        <h2 class="slide-title slide-title--large">Focus on intent, not implementation</h2>
        <p class="slide-subtitle">Code that reads more like prose, than a computer science textbook</p>
      </div>

      <nav class="slide-nav">
        <a href="#code-concern" class="nav-link">‚Üê</a>
        <a href="#service-comparison" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Service Object Comparison
         ================================================================ -->
    <section class="slide slide--dark" id="service-comparison">
      <div class="slide-inner">
        <h2 class="slide-title">Boilerplate obscures intent</h2>

        <div class="code-tabs">
          <div class="code-tabs-nav">
            <button class="code-tab active" data-tab="simple">Simple: single domain call</button>
            <button class="code-tab" data-tab="complex">Complex: extracting to a form object</button>
          </div>

          <div class="code-tab-content active" id="tab-simple">
            <div class="comparison">
              <div class="comparison-side comparison-side--bad">
                <h3>With a service object</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby"># In the controller
Card::SendBackToTriageService.call(card)

# Separate service class
class Card::SendBackToTriageService
  def initialize(card)
    @card = card
  end

  def call
    @card.transaction do
      @card.resume
      @card.update! column: nil
      @card.track_event :sent_back_to_triage
    end
  end
end</code></pre>
                </div>
              </div>

              <div class="comparison-side comparison-side--good">
                <h3>Directly on the domain</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby"># In the controller
card.send_back_to_triage

module Card::Triageable
  def send_back_to_triage
    transaction do
      resume
      update! column: nil
      track_event :sent_back_to_triage
    end
  end
end

</code></pre>
                </div>
                <p class="slide-text" style="margin-top: 1rem; font-size: 1rem;">
                  What isn't there is as important as what is.<br>
                  The sooner we can get to the point, the faster we'll understand the intent.
                </p>
              </div>
            </div>
          </div>

          <div class="code-tab-content" id="tab-complex">
            <div class="complex-example">
              <div class="complex-example-side">
                <h3>Controller</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby">class Signups::CompletionsController
  def create
    @signup = Signup.new(signup_params)

    if @signup.complete
      redirect_to landing_url
    else
      render :new, status: :unprocessable_entity
    end
  end
end</code></pre>
                </div>
              </div>

              <div class="complex-example-side">
                <h3>Form object</h3>
                <div class="code-container">
                  <pre class="code-block"><code class="language-ruby">class Signup
  include ActiveModel::Model

  attr_accessor :full_name, :identity
  validates :full_name, :identity, presence: true

  def complete
    valid? && create_account
  end

  private
    def create_account
      Account.create_with_owner(...)
    end
end</code></pre>
                </div>
              </div>
            </div>
            <p class="slide-text" style="margin-top: 1rem; font-size: 1rem;">
              When orchestration grows complex, extract it to a form object. It stays in the domain, supports validation, and uses semantic naming.
            </p>
          </div>
        </div>

        <p class="speaker-notes">
          Jorge explains how wrapping a single line in a service object adds a lot of distracting boilerplate.
          I'd like to think that most people would agree with this simple example so I wanted to make it more interesting by including the implementation for comparison.
          <br><br>
          On the left we see a lot of feature envy and unnecessary ceremony to initialize the service object. We add noise without value by explicitly referring
          to the object as a service and call `call` on it.
          <br><br>
          On the right we see the method directly on the model. There's no feature envy here which allows us to focus on intent rather than syntax.
          <br><br>
          There are still good examples on when a Controller might want to delegate orchestration to a service object.
          In this example we use a form object to coordinate multiple things to keep the controller slim and focused on the bigger picture.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#chapter-simpler-way" class="nav-link">‚Üê</a>
        <a href="#semantic-naming" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Semantic Naming
         ================================================================ -->
    <section class="slide slide--dark" id="semantic-naming">
      <div class="slide-inner">
        <h2 class="slide-title">Semantic names over generic patterns</h2>

        <div class="naming-examples">
          <div class="naming-row">
            <code class="naming-bad">CardGildingService.call(card)</code>
            <span class="naming-arrow">‚Üí</span>
            <code class="naming-good">card.gild</code>
          </div>
          <div class="naming-row">
            <code class="naming-bad">ResumeCardOperation.new(card).execute</code>
            <span class="naming-arrow">‚Üí</span>
            <code class="naming-good">card.resume</code>
          </div>
        </div>

        <p class="slide-text" style="margin-top: 2rem;">
          Generic verbs like <code>call</code> and <code>execute</code> say nothing about intent, they don't add value or information.<br>
          Domain methods read like prose:<em>"Gild the card."</em>, <em>"Resume the card."</em>.
        </p>

        <p class="speaker-notes">
          This is another example of something Jorge mentions‚Äîthey don't use the word "service" and they avoid method names like `call` or `execute`.
          When we compare `CardGildingService.call(card)` versus `card.gild` it is easy to see how the second one reads like English prose where as the first one is focused on the implementation.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#service-comparison" class="nav-link">‚Üê</a>
        <a href="#chapter-orchestration" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         CHAPTER 4: ORCHESTRATION & COMPOSITION
         ============================================================ -->

    <!-- ================================================================
         Chapter Divider: Orchestration
         ================================================================ -->
    <section class="slide slide--accent" id="chapter-orchestration">
      <div class="slide-inner">
        <p class="chapter-label">Chapter 3</p>
        <h2 class="slide-title slide-title--large">Orchestration</h2>
        <p class="slide-subtitle">Controllers and jobs</p>
      </div>

      <nav class="slide-nav">
        <a href="#semantic-naming" class="nav-link">‚Üê</a>
        <a href="#quote-service-objects" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Quote: Service Objects
         ================================================================ -->
    <section class="slide slide--pattern" id="quote-service-objects">
      <div class="slide-inner">
        <div class="quote">
          <p class="quote-text">Service objects are not meant to implement your business logic. They are meant to orchestrate your domain objects.</p>
          <p class="quote-author">Jorge Manrubia, 37signals</p>
        </div>
      </div>

      <nav class="slide-nav">
        <a href="#chapter-orchestration" class="nav-link">‚Üê</a>
        <a href="#code-controller" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Code: Controller
         ================================================================ -->
    <section class="slide slide--dark" id="code-controller">
      <div class="slide-inner">
        <h2 class="slide-title">Thin orchestration layers</h2>

        <div class="code-tabs">
          <div class="code-tabs-nav">
            <button class="code-tab active" data-tab="controller">app/controllers/cards/closures_controller.rb</button>
            <button class="code-tab" data-tab="job">app/jobs/card/activity_spike/detection_job.rb</button>
          </div>

          <div class="code-tab-content active" id="tab-controller">
            <pre class="code-block"><code class="language-ruby">class Cards::ClosuresController < ApplicationController
  include CardScoped

  def create
    @card.close
  end

  def destroy
    @card.reopen
  end
end</code></pre>
          </div>

          <div class="code-tab-content" id="tab-job">
            <pre class="code-block"><code class="language-ruby">class Card::ActivitySpike::DetectionJob < ApplicationJob
  def perform(card)
    card.detect_activity_spikes
  end
end</code></pre>
          </div>
          <p class="slide-text" style="margin-top: 1rem; color: var(--tt-grey-43);">
            Controllers connect our domain models with the external world.
            In much the same way, jobs act as a thin layer of orchestration for our domain logic.
          </p>
          <p class="slide-text" style="margin-top: 1rem; color: var(--tt-grey-43);">
            These <em>are</em> our service objects, we just don't call them that.
          </p>
        </div>

        <p class="speaker-notes">
          Controllers connect our domain models with the external world.
          In much the same way, jobs act as a thin layer of orchestration for our domain logic.
          Jorge makes this point that controllers and jobs are already doing what service objects do.
          They orchestrate.
          The difference is they're built into Rails and most of the ceremony has been extracted away by the framework.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#quote-service-objects" class="nav-link">‚Üê</a>
        <a href="#concerns-composition" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Concerns + Composition
         ================================================================ -->
    <section class="slide slide--dark" id="concerns-composition">
      <div class="slide-inner">
        <h2 class="slide-title">Concerns + object composition = ‚ù§Ô∏è</h2>

        <div class="code-container">
          <span class="code-filename">app/models/card/stallable.rb</span>
          <pre class="code-block"><code class="language-ruby">module Card::Stallable
  extend ActiveSupport::Concern

  included do
    has_one :activity_spike, class_name: "Card::ActivitySpike"
    after_update_commit :detect_activity_spikes
  end

  def stalled?
    open? && last_activity_spike_at < 14.days.ago
  end

  def detect_activity_spikes
    Card::ActivitySpike::Detector.new(self).detect
  end
end</code></pre>
        </div>

        <p class="slide-text">
          The concern organizes the API. The <code>Detector</code> object takes care of detection details.<br>
          Concerns don't replace object-oriented design‚Äîthey complement it.
        </p>

        <p class="speaker-notes">
          Concerns and object composition work great together.
          The concern gives you a natural API to work with where you don't have to know about the complexity that might or might not be abstracted by an underlying object.
        </p>
      </div>

      <nav class="slide-nav">
        <a href="#code-controller" class="nav-link">‚Üê</a>
        <a href="#takeaways" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ============================================================
         TAKEAWAYS
         ============================================================ -->

    <!-- ================================================================
         Key Takeaways
         ================================================================ -->
    <section class="slide slide--gradient" id="takeaways">
      <div class="slide-inner">
        <h2 class="slide-title">Key Takeaways</h2>

        <ul class="takeaways">
          <li>Let the domain model take the center stage in your architecture</li>
          <li>Use concerns to organize traits that belong together</li>
          <li>Prefer semantic names over generic verbs like <code>call</code></li>
          <li>Controllers and jobs orchestrate; they don't hold business logic</li>
          <li>Minimize boilerplate to allow intent to be more directly accessible</li>
          <li>Prioritize what's coherent for humans over theoretical purity</li>
        </ul>
      </div>

      <nav class="slide-nav">
        <a href="#concerns-composition" class="nav-link">‚Üê</a>
        <a href="#questions" class="nav-link">‚Üí</a>
      </nav>
    </section>

    <!-- ================================================================
         Questions
         ================================================================ -->
    <section class="slide slide--accent" id="questions">
      <div class="slide-inner">
        <h2 class="slide-title slide-title--large">Questions?</h2>
      </div>

      <nav class="slide-nav">
        <a href="#takeaways" class="nav-link">‚Üê</a>
        <span class="nav-disabled">‚Üí</span>
      </nav>
    </section>

  </div>

  <!-- Prism.js for syntax highlighting with autoloader -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script>
    Prism.plugins.autoloader.languages_path = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/';
  </script>

  <!-- Keyboard navigation -->
  <script src="keyboard.js"></script>
</body>
</html>
